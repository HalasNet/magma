<datasources>
  <datasource class="datasourceBean">

    <name>onyx</name>
    <type>onyx-1.6.x</type>

    <properties>
      <property name="url" value="jdbc:mysql://localhost/onyx" />
      <property name="driverClass" value="com.mysql.jdbc.Driver" />
      <property name="username" value="root" />
      <property name="password" value="" />
      <property name="configDir" value="file:/home/onyx/config" />
    </properties>

    <collections>
      <collection class="collectionBean">
        <name>onyx-baseline</name>

        <valueSets>
          <valueSetReferenceProvider class="jpaProvider">
            <entityClass>org.obiba.onyx.core.domain.Interview</entityClass>
            <entityType>Participant</entityType>
            <entityIdentifierProperty>participant.barcode</entityIdentifierProperty>
            <identifierProperty>startDate</identifierProperty>
          </valueSetReferenceProvider>
          <valueSetReferenceProvider class="jpaProvider">
            <entityClass>org.obiba.onyx.jade.core.domain.Instrument</entityClass>
            <entityType>Instrument</entityType>
            <entityIdentifierProperty>barcode</entityIdentifierProperty>
            <identifierProperty>startDate</identifierProperty>
          </valueSetReferenceProvider>
        </valueSets>

        <variableValueSourceProviders>
          <beanVariableValueSourceProvider>
            <entityType>Participant</entityType>
            <beanClass>org.obiba.onyx.core.domain.Participant</beanClass>
            <prefix>Participant</prefix>
            <properties>
              <string>firstName</string>
              <string>lastName</string>
              <string>gender</string>
              <string>appointment.date</string>
              <string>birthDate</string>
            </properties>
            <nameMap>
              <entry key="appointment.date" value="appointmentDate" />
            </nameMap>
          </beanVariableValueSourceProvider>

          <beanVariableValueSourceProvider>
            <entityType>Instrument</entityType>
            <beanClass>org.obiba.onyx.jade.core.domain.Instrument</beanClass>
            <prefix>Instrument</prefix>
            <properties>
              <string>vendor</string>
              <string>serialNumber</string>
              <string>barcode</string>
            </properties>
          </beanVariableValueSourceProvider>
        </variableValueSourceProviders>

        <variableValueSources>
          <scriptedVariableSource>
            <variable name="Participant.birthYear" valueType="integer" entityType="Participant">
              <!--
                The script should be made an attribute of the variable. Such that we know how it was derived. It's the
                variable's algorithm.
              -->
              <script>dateYear($('Participant.birthDate'))</script>
            </variable>
          </scriptedVariableSource>
        </variableValueSources>
      </collection>

    </collections>
  </datasource>

  <datasource>
    <name>wager</name>
    <type>jdbc</type>

    <collections>
      <collection class="collectionBean">

        <valueSets>
          <valueSetProvider class="jdbcProvider">
            <entitySql>select * from subject where status = 1;</entitySql>
            <idColumn>SUBJECTKEY</idColumn>
            <entityType>Participant</entityType>
          </valueSetProvider>

          <valueSetProvider class="jdbcProvider">
            <entitySql>select * from study where status = 1;</entitySql>
            <idColumn>STUDYKEY</idColumn>
            <entityType>Study</entityType>
          </valueSetProvider>
        </valueSets>

        <variableValueProviders>
          <resultSetProvider>
            <entityType>Participant</entityType>
            <variables>
              <prefix>Participant</prefix>
              <sql>select * from PD_FIELD as F join PD_DATATYPE as DT on(F.DATATYPEKEY = DT.DATATYPEKEY)</sql>
              <variable>
                <name>FIELD_NAME</name>
                <valueType>DT.DATATYPE_NAME</valueType>
                <unit>UNITS</unit>
                <attributes>
                  <attribute name="id">FIELDKEY</attribute>
                  <attribute name="maxValue">MAX_VALUE</attribute>
                  <attribute name="minValue">MIN_VALUE</attribute>
                </attributes>
              </variable>
            </variables>
            <data>
              <sql>select * from PD_DATA where SUBJECTKEY = ? AND FIELDKEY = ?</sql>
              <parameter>reference.entity.id</parameter>
              <parameter>variable.attributes.id</parameter>
            </data>
          </resultSetProvider>

          <tableProvider>
            <entityType>Study</entityType>
            <table>study</table>
            <columns>
              <column name="name">NAME</column>
              <column name="name">NAME</column>
            </columns>
          </tableProvider>
        </variableValueProviders>
      </collection>
    </collections>
  </datasource>
</datasources>