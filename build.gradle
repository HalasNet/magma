apply plugin: 'idea'
apply from: 'libraries.gradle'

ext {
  javaVersion = '1.6'
}

allprojects {

  apply plugin: 'java'
  apply plugin: 'maven'

  group = 'org.obiba.magma'
  version = '1.6-gradle-SNAPSHOT'

  sourceCompatibility = javaVersion
  targetCompatibility = javaVersion

  defaultTasks 'build'

  buildDir = 'target'

  repositories {
    mavenLocal()
    mavenRepo url: 'http://repo.obiba.org/repo'
    mavenCentral()
  }

  tasks.withType(Compile) {
    options.encoding = 'UTF-8'
  }

  configurations {
    compile
    runtime
    all*.exclude group: 'commons-logging'
  }

  apply plugin: 'pmd'
  pmd {
    targetJdk = javaVersion
    ignoreFailures = true   // Don't fail the build process when rule violations are found.
//    ruleSetFiles = files('https://github.com/obiba/conventions/raw/master/obiba-pmd-ruleset.xml')
  }

  // FindBugs
//  apply plugin: 'findbugs'
//  tasks.withType(FindBugs) {
//    reports.html.enabled true
//    reports.xml.enabled false
//  }

}

task wrapper(type: Wrapper) {
  gradleVersion = '1.5'
}

subprojects {

  task packageSources(type: Jar) {
    classifier = 'sources'
    from sourceSets.main.allSource
  }

  artifacts.archives packageSources

  dependencies {
    compile(libraries.guava)
    compile(libraries.slf4j_api)
    compile(libraries.jsr305)
    compile(libraries.findbugs_annotation)

    testCompile(libraries.junit)
    testCompile(libraries.easymock)
    testCompile(libraries.hamcrest)
    testCompile(libraries.slf4j_log4j12)
    testCompile(libraries.jcl_slf4j)
  }

}
